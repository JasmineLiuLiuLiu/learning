# volatile

## 特性

### 变量可见性

可见性指的是当一个线程修改了变量的值，那么新的值对于其他线程是可以立即获取的。  
当对非`volatile`变量进行读写的时候，每个线程先从内存拷贝变量到CPU缓存中。如果计算机有多个CPU，每个线程可能在不同的CPU上被处理，这意味着每个线程可以拷贝变量到不同的CPU缓存中。JVM读取`volatile`变量时，保证了每次读变量都从内存中读，跳过 CPU缓存这一步。

### 原子性

对任意单个`volatile`变量的读/写具有原子性，但类似于`volatile++`这种复合操作不具有原子性。

## 内存语义

`volatile`的写-读与锁的释放-获取有相同的内存效果。
当写一个`volatile`变量时，JMM会把该线程对应的本地内存中的**共享变量**值刷新到主内存；当读一个`volatile`变量时，JMM会把该线程对应的本地内存置为无效。线程接下来将从主内存中读取**共享变量**。*（jasmine：也就是说写volatile会把所有的共享变量写入主内存，而一旦读到volatile值有改变，本地内存立即失效，然后共享变量全部从主内存重新读）*

## 禁止重排序

规则表
| 是否能重排序| | 第二个操作 | |
| -- | -- | -- | -- |
| 第一个操作 | 普通读/写 | volatile读 | volatile写 |
| 普通读/写 | | | NO |
| volatile读 | NO | NO | NO |
| volatile写 | | NO | NO |
